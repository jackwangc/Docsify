# i/o 模型

## 同步，异步，阻塞，非阻塞

> IO，常协作I/O，是Input/Output的简称，即输入/输出。通常指数据在内部存储器（内存）和外部存储器（硬盘、优盘等）或其他周边设备之间的输入和输出
> 1. 阻塞、非阻塞和同步、异步其实针对的对象是不一样的
> 2. 阻塞、非阻塞说的是调用者，同步、异步说的是被调用者

* 同步请求，A调用B，B的处理是同步的，在处理完之前他不会通知A，只有处理完之后才会明确的通知A

* 异步请求，A调用B，B的处理是异步的，B在接到请求后先告诉A我已经接到请求了，然后异步去处理，处理完之后通过回调等方式再通知A

* 阻塞请求，A调用B，A一直等着B的返回，别的事情什么也不干

* 非阻塞请求，A调用B，A不用一直等着B的返回，先去忙别的事情了

## io 模型

> 阻塞IO、非阻塞IO、信号驱动IO、IO 复用模型(IO多路转接)、异步IO。

### 阻塞 IO 模型

* 阻塞 I/O 是最简单的 I/O 模型，一般表现为进程或线程等待某个条件，如果条件不满足，则一直等下去。条件满足，则进行下一步操作

### 非阻塞 IO 模型

* 应用进程与内核交互，目的未达到之前，不再一味的等着，而是直接返回。然后通过轮询的方式，不停的去问内核数据准备有没有准备好。如果某一次轮询发现数据已经准备好了，那就把数据拷贝到用户空间中。

### IO 复用模型

* 多个进程的 IO 可以注册到同一个管道上，这个管道会统一和内核进行交互。当管道中的某一个请求需要的数据准备好之后，进程再把对应的数据拷贝到用户空间中。

### 信号驱动 IO 模型

* 应用进程在读取文件时通知内核，如果某个 socket 的某个事件发生时，请向我发一个信号。在收到信号后，信号对应的处理函数会进行后续处理。

### 异步 IO 模型

* 应用进程把 IO 请求传给内核后，完全由内核去操作文件拷贝。内核完成相关操作后，会发信号告诉应用进程本次 IO 已经完成。

* 异步 I/O 与信号驱动 I/O 的区别在于：异步 I/O 的信号是通知应用进程 I/O 完成，而信号驱动 I/O 的信号是通知应用进程可以开始 I/O


## Java 中的三种 IO 模型

> java IO 模型和操作系统 IO 模型关系

### 阻塞 IO（BIO）

同步阻塞 I/O 模式，数据的读取写入必须阻塞在一个线程内等待其完成。

BIO （Blocking I/O）：有一排水壶在烧开水，BIO 的工作模式就是，叫一个线程停留在一个水壶那，直到这个水壶烧开，才去处理下一个水壶。但是实际上线程在等待水壶烧开的时间段什么都没有做。

BIO 和 NIO 都是同步的 IO 模型，即同步阻塞 IO 和同步非阻塞 IO

### 非阻塞 IO（NIO）

同时支持阻塞与非阻塞模式，但主要是使用同步非阻塞 IO。

NIO （New I/O）：NIO 的做法是叫一个线程不断的轮询每个水壶的状态，看看是否有水壶的状态发生了改变，从而进行下一步的操作。

### 异步 IO（AIO）

异步非阻塞 I/O 模型。

异步 IO 指的是异步非阻塞 IO。

AIO （ Asynchronous I/O）：为每个水壶上面装了一个开关，水烧开之后，水壶会自动通知我水烧开了。

### 适用场景

1. BIO方式适用于连接数目比较小且固定的架构，这种方式对服务器资源要求比较高，并发局限于应用中，JDK1.4以前的唯一选择，但程序直观简单易理解。
2. NIO方式适用于连接数目多且连接比较短（轻操作）的架构，比如聊天服务器，并发局限于应用中，编程比较复杂，JDK1.4开始支持。
3. AIO方式适用于连接数目多且连接比较长（重操作）的架构，比如相册服务器，充分调用OS参与并发操作，编程比较复杂，JDK7开始支持。

## NIO

> NIO 与原来的 I/O 有同样的作用和目的, 他们之间最重要的区别是数据打包和传输的方式。原来的 I/O 以流的方式处理数据，而 NIO 以块的方式处理数据。
> * 面向流的 I/O 系统一次一个字节地处理数据。一个输入流产生一个字节的数据，一个输出流消费一个字节的数据。
> * 面向块的 I/O 系统以块的形式处理数据。每一个操作都在一步中产生或者消费一个数据块。按块处理数据比按(流式的)字节处理数据要快得多。但是面向块的 I/O 缺少一些面向流的 I/O 所具有的优雅性和简单性。

1. selector 
   1. serverSelector负责轮询是否有新的连接，服务端监测到新的连接之后，不再创建一个新的线程，而是直接将新连接绑定到clientSelector上 
   2. 减少线程数量
2. buffer
   1. 每次从缓冲区读取数据
3. channel
   1. 数据读取从通道开始进行
   2. 创建缓冲区，然后利用通道进行读取操作 

---

## 参考

1. [nio解析](https://zhuanlan.zhihu.com/p/23488863)
2. [nio,bio,aio](https://blog.csdn.net/m0_38109046/article/details/89449305)
3. [nio 详解](https://blog.csdn.net/qq_28261343/article/details/52769969)
